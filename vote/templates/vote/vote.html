{% extends 'vote/base.html' %}

{% block title %}التصويت{% endblock %}

{% block content %}
<div class="vote-section">
    <h2>صفحة التصويت 🗳️</h2>

    {% for data in sessions_data %}
        <div class="vote-session-card" style="border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <h3>{{ data.session.title }}</h3>
            {% if data.session.description %}
                <p>{{ data.session.description }}</p>
            {% endif %}
            <p>
                ⏳ مدة التصويت: من {{ data.session.start_at|date:"Y-m-d H:i" }} إلى {{ data.session.expires_at|date:"Y-m-d H:i" }}
            </p>

            {% if data.session.expires_at < now %}
                <!-- التصويت منتهي -->
                <div class="vote-closed-alert" style="background: #f8d7da; padding: 10px; border-radius: 6px; border: 1px solid #f5c6cb; color: #721c24;">
                    ⏰ انتهى وقت التصويت. يمكنك مشاهدة النتائج.
                </div>
                <h4>📊 النتائج:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>📌 {{ result.option__text }} - {{ result.count }} صوت ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>👥 عدد المصوتين: {{ data.total_votes }}</p>

            {% elif data.session.start_at > now %}
                <!-- التصويت لم يبدأ بعد -->
                <div class="vote-not-started-alert" style="background: #fff3cd; padding: 10px; border-radius: 6px; border: 1px solid #ffeeba; color: #856404;">
                    ⏳ التصويت لم يبدأ بعد. يبدأ في: {{ data.session.start_at|date:"Y-m-d H:i" }}
                </div>

            {% elif data.already_voted %}
                <!-- تم التصويت مسبقًا -->
                <p style="color: #4caf50; font-weight: bold;">✅ تم التصويت</p>
                <h4>📊 النتائج:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>📌 {{ result.option__text }} - {{ result.count }} صوت ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>👥 عدد المصوتين: {{ data.total_votes }}</p>

            {% elif can_vote == "لا" %}
                <!-- لا يسمح له بالتصويت -->
                <div class="vote-not-allowed-alert" style="background: #f8d7da; padding: 10px; border-radius: 6px; border: 1px solid #f5c6cb; color: #721c24;">
                    ❌ لا يُسمح لك بالتصويت، ولكن يمكنك مشاهدة النتائج.
                </div>
                <h4>📊 النتائج:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>📌 {{ result.option__text }} - {{ result.count }} صوت ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>👥 عدد المصوتين: {{ data.total_votes }}</p>

            {% else %}
                <!-- نموذج التصويت -->
                <form method="post" class="vote-form">
                    {% csrf_token %}
                    <input type="hidden" name="session_id" value="{{ data.session.id }}">
                    <ul>
                        {% for option in data.options %}
                            <li>
                                <label>
                                    <input type="radio" name="option" value="{{ option.id }}" required>
                                    {{ option.text }}
                                </label>
                            </li>
                        {% endfor %}
                    </ul>
                    <button type="submit" class="vote-btn">تصويت</button>
                </form>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% endblock %}
