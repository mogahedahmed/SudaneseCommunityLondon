{% extends 'vote/base.html' %}

{% block title %}Ø§Ù„ØªØµÙˆÙŠØª{% endblock %}

{% block content %}
<div class="vote-section">
    <h2>ØµÙØ­Ø© Ø§Ù„ØªØµÙˆÙŠØª ğŸ—³ï¸</h2>

    <!-- âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§ Ù‡Ù†Ø§ -->
    <h3 style="text-align: center; margin-bottom: 20px; color: #444;">
        ğŸ‘‹ Ù…Ø±Ø­Ø¨Ù‹Ø§ {{ full_name }}ØŒ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØµÙˆÙŠØª!
    </h3>

    {% for data in sessions_data %}
        <div class="vote-session-card" style="border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
            <h3>{{ data.session.title }}</h3>
            {% if data.session.description %}
                <p>{{ data.session.description }}</p>
            {% endif %}
            <p>
                â³ Ù…Ø¯Ø© Ø§Ù„ØªØµÙˆÙŠØª: Ù…Ù† {{ data.session.start_at|date:"Y-m-d H:i" }} Ø¥Ù„Ù‰ {{ data.session.expires_at|date:"Y-m-d H:i" }}
            </p>

            {% if data.session.expires_at < now %}
                <!-- Ø§Ù„ØªØµÙˆÙŠØª Ù…Ù†ØªÙ‡ÙŠ -->
                <div class="vote-closed-alert" style="background: #f8d7da; padding: 10px; border-radius: 6px; border: 1px solid #f5c6cb; color: #721c24;">
                    â° Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª. ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.
                </div>
                <h4>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>ğŸ“Œ {{ result.option__text }} - {{ result.count }} ØµÙˆØª ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµÙˆØªÙŠÙ†: {{ data.total_votes }}</p>

            {% elif data.session.start_at > now %}
                <!-- Ø§Ù„ØªØµÙˆÙŠØª Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯ -->
                <div class="vote-not-started-alert" style="background: #fff3cd; padding: 10px; border-radius: 6px; border: 1px solid #ffeeba; color: #856404;">
                    â³ Ø§Ù„ØªØµÙˆÙŠØª Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø¨Ø¹Ø¯. ÙŠØ¨Ø¯Ø£ ÙÙŠ: {{ data.session.start_at|date:"Y-m-d H:i" }}
                </div>

            {% elif data.already_voted %}
                <!-- ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª Ù…Ø³Ø¨Ù‚Ù‹Ø§ -->
                <p style="color: #4caf50; font-weight: bold;">âœ… ØªÙ… Ø§Ù„ØªØµÙˆÙŠØª</p>
                <h4>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>ğŸ“Œ {{ result.option__text }} - {{ result.count }} ØµÙˆØª ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµÙˆØªÙŠÙ†: {{ data.total_votes }}</p>

            {% elif can_vote == "Ù„Ø§" %}
                <!-- Ù„Ø§ ÙŠØ³Ù…Ø­ Ù„Ù‡ Ø¨Ø§Ù„ØªØµÙˆÙŠØª -->
                <div class="vote-not-allowed-alert" style="background: #f8d7da; padding: 10px; border-radius: 6px; border: 1px solid #f5c6cb; color: #721c24;">
                    âŒ Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ù„Ùƒ Ø¨Ø§Ù„ØªØµÙˆÙŠØªØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬.
                </div>
                <h4>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬:</h4>
                <ul>
                    {% for result in data.results %}
                        <li>ğŸ“Œ {{ result.option__text }} - {{ result.count }} ØµÙˆØª ({{ result.percent }}%)</li>
                    {% endfor %}
                </ul>
                <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµÙˆØªÙŠÙ†: {{ data.total_votes }}</p>

            {% else %}
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØµÙˆÙŠØª (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡) -->
                <form method="post" class="vote-form" style="margin-top: 15px;">
                    {% csrf_token %}
                    <input type="hidden" name="session_id" value="{{ data.session.id }}">

                    <ul style="list-style: none; padding: 0; margin: 10px 0;">
                        {% for option in data.options %}
                            <li style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="radio" id="option-{{ option.id }}" name="option" value="{{ option.id }}" required
                                       style="width: 18px; height: 18px;">
                                <label for="option-{{ option.id }}" 
                                       style="margin-right: 10px; font-size: 15px; cursor: pointer;">
                                    {{ option.text }}
                                </label>
                            </li>
                        {% endfor %}
                    </ul>

                    <button type="submit" class="vote-btn" style="
                        background: #e53935;
                        border: none;
                        padding: 10px 20px;
                        color: white;
                        border-radius: 8px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: 0.3s;
                        width: 100%;
                    " onmouseover="this.style.background='#c62828'" onmouseout="this.style.background='#e53935'">
                        ØªØµÙˆÙŠØª
                    </button>
                </form>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% endblock %}
